import anthropic

client = anthropic.Anthropic(
    # defaults to os.environ.get("ANTHROPIC_API_KEY")
    api_key="my_api_key",
)

# Replace placeholders like {{INVOICE_TEXT}} with real values,
# because the SDK does not support variables.
message = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=8192,
    temperature=0,
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "<examples>\n<example>\n<INVOICE_TEXT>\n------------------------------- Page 1 -------------------------------\n\n                               GPS M                                            G\nMoradabad, Uttar Pradesh, India                  Moradabad, Uttar Pradesh, India\nRpwq+85w, Pac Khushalpur Rd, Khushh             Rpwq+85w, Pac Khushalpur Rd, Kh\nMoradabad, Uttar Pradesh 244001, Indi             Moradabad, Uttar Pradesh 244001\nLat 28.845778° Long 78.737862°                   Lat 28.845776° Long 78.73783º\n27/11/24 05:56 PM GMT +05:30       gle         27/11/24 06:21 PM GMT +05:30\n                                GPS M\n                                                      Moradabad, Uttar Pradesh, Ir\n Moradabad, Uttar Pradesh, India                     Rpwq+85w, Pac Khushalpur Rd\n Rpwq+85w, Pac Khushalpur Rd, Khushh                Moradabad, Uttar Pradesh 244\n Moradabad, Uttar Pradesh 244001, Indi                Lat 28.845801° Long 78.73784\n Lat 28.845808° Long 78.737851º      oogle         27/11/24 06:29 PM GMT +05:3\n 27/11/24 06:29 PM GMT +05:30\n\n------------------------------- Page 2 -------------------------------\n\nGST No: 09AAXFB6745J1ZN      BAHUBALI BROTHERS         Mobile :9760679374\n                                 Sai mandir Road, Moradabad\n                                                                      27.11.24\n                                                                                          --\n             TO,\n               J.K white Cements,\n                 GhaziBad\n                 Subject :-    C.S. M. Meeting\n               Dear Sir,\n      we Conduct the C.SM. Meeting at \"Kunal Paint Store\" on 27.11.26. in which\n           15 No. of Painters had attend the meeting.\n                                    Thank You.\n                                                      Tor Bakuroli Aroche\n                                                                     Partring\n\n------------------------------- Page 3 -------------------------------\n\n Name of Event  CSM                Place of Event  Bharat Paint Store.\n Event  Date of  22-11-24              Name of Gift  Bedsheet\n Sr. No.  Participant Name                Registered  With JK -Y/N        Mobile No.\n   1    Zubair                             9548651035\n   2     Shuaib                             9675608067\n   3  A  5   waseem  & Foshad  Yusuf Ali                           9675604537  9758100588  9756476187\n   6    Saleem                              9058996435\n   7    Nagel                                9675144290\n   8    Zeeshan                              9548451987\n   9    Zullizar                             7078009478\n  10    Akthar Ali                           9720640042\n  11    Saleem Khan                       8272936736\n  12    ·Irasat Ali                         8859958547 .\n   13  Yabin                               8859565580\n   14    Aasiad                             827-2886536\n   15    Lalek                                 8446931661\nTotal No. of Gifts Distributed.   15.\nSignature with Name                 Signature with Name\n(Concern CTS Executive)               (Concern Marketing Executive)  70 19\nStockiest/Dealer Stamp & Sign  Tande Diel Rampur  BHARAT PAINT STORE                faxmany  24/12/24\n            Pin code : #44925\n\n------------------------------- Page 4 -------------------------------\n\n                    Cash Memo       7055123455\n Ganesh Sweets & Restaurant\n     Add .:- Gurhatti Chauraha, Moradabad UP\n            We Deals in All Types of Sweets   22.11.24\nS.\nNo       Descriptions      Qty.     Rate      Amount\n1.    Snacks            15      50%-      7901-\n                     ,\n                                                     4\n                                        ,\n                          ..\n                         Total           750/-\n                                                   ,\n                                            Signature\n</INVOICE_TEXT>\n<ideal_output>\n<invoice_breakdown>\n1. Invoice Number:\n   Relevant text: \"Cash Memo 7055123455\" (Page 4)\n   Reasoning: This appears to be a unique identifier for the transaction, typically used as an invoice number on cash memos or receipts.\n   Conclusion: The invoice number is likely 7055123455.\n\n2. Invoice Amount:\n   Relevant text: \"Total 750/-\" (Page 4)\n   Reasoning: This is explicitly stated as the total amount on the cash memo.\n   Conclusion: The invoice amount is 750/- (assumed to be in INR).\n\n3. GST Amount:\n   Relevant text: None found\n   Reasoning: There is no explicit mention of GST or tax amount on the cash memo or elsewhere in the document.\n   Conclusion: Not found\n\n4. IRN Number:\n   Relevant text: None found\n   Reasoning: There is no mention of an IRN (Invoice Reference Number) in the document.\n   Conclusion: Not found\n\n5. Invoice Date:\n   Relevant text: \"22.11.24\" (Page 4)\n   Reasoning: This date is mentioned on the cash memo page and is likely the date of the transaction.\n   Conclusion: The invoice date is 22.11.24 (assuming DD.MM.YY format).\n\n6. Customer Name:\n   Relevant text: None specifically for this transaction\n   Reasoning: The document contains multiple names and references, but none clearly identified as the customer for this specific cash memo.\n   Conclusion: Not found\n\n7. Seller Name:\n   Relevant text: \"Ganesh Sweets & Restaurant\" (Page 4)\n   Reasoning: This name is prominently displayed at the top of the cash memo, indicating it's the business issuing the receipt.\n   Conclusion: The seller name is Ganesh Sweets & Restaurant.\n\nCurrency:\n   Relevant text: \"750/-\" (Page 4)\n   Reasoning: The use of the \"/-\" notation is common in Indian currency representation. Additionally, the document mentions locations in India (Moradabad, Uttar Pradesh).\n   Conclusion: The currency is likely INR (Indian Rupees).\n</invoice_breakdown>\n\n<<\nInvoice Number: 7055123455\nInvoice Amount: 750\nGST Amount: Not found\nIRN Number: Not found\nInvoice Date: 22.11.24\nCustomer Name: Not found\nSeller Name: Ganesh Sweets & Restaurant\n>>\n\nCURRENCY: INR\n</ideal_output>\n</example>\n</examples>\n\n"
                },
                {
                    "type": "text",
                    "text": "You are an AI assistant specialized in extracting specific information from invoice texts. Your task is to analyze the following invoice and extract key fields:\n\n<invoice_text>\n{{INVOICE_TEXT}}\n</invoice_text>\n\nRequired fields to extract:\n1. Invoice Number\n2. Invoice Amount\n3. GST Amount\n4. IRN Number\n5. Invoice Date\n6. Customer Name\n7. Seller Name\n\nInstructions:\n1. Carefully read through the entire invoice text.\n2. For each required field:\n   a. Look for explicit mentions of the field in the text.\n   b. If not explicitly stated, attempt to infer the information based on context.\n   c. If the field cannot be found or inferred, use \"Not found\" as the value.\n3. Conduct a thorough analysis for each field, showing your reasoning process.\n4. Present your findings in the specified format (see below).\n\nField Analysis Process:\nFor each field:\n1. List all text from the invoice that might be relevant to the field, even if not explicitly labeled.\n2. For each piece of relevant text, reason about why it might or might not be the correct information for the field.\n3. Choose the most likely correct information based on your reasoning.\n4. If you can't find or infer the information, explain why it's not possible.\n\nOutput Format:\nPresent your final output in the following format, enclosed in double angle brackets:\n\n<<\nInvoice Number: [value]\nInvoice Amount: [value]\nGST Amount: [value]\nIRN Number: [value]\nInvoice Date: [value]\nCustomer Name: [value]\nSeller Name: [value]\n>>\n\nAdditional Guidelines:\n- Focus only on invoice-related information, ignoring irrelevant text.\n- If unsure about a field's value, use \"Unclear\" instead of guessing.\n- For multiple possible values, choose the most likely one based on context.\n- Stick strictly to the field-value format in your final output.\n\nBefore providing your final output, wrap your analysis process for each field in <invoice_breakdown> tags. This analysis is crucial, especially when information isn't explicitly stated and requires logical deduction. It's OK for this section to be quite long.\n\nNow, proceed with your analysis and extraction of the invoice information."
                }
            ]
        },
        {
            "role": "assistant",
            "content": [
                {
                    "type": "text",
                    "text": "<invoice_breakdown>"
                }
            ]
        }
    ]
)
print(message.content)
